---
title: "Intermediate Tips"
subtitle: "Data4All"
author: "Ted Laderas, PhD"
format: 
  live-html:
    scrollable: true
    toc-location: left
engine: knitr
webr:
  render-df: paged-table
  packages:
    - ggplot2
    - dplyr
    - DT
    - readr
    - janitor
  resources:
    - data
pyodide:
  render-df: paged-table
  resources:
    - data
  packages:
    - openpyxl
    - pandas
---

## Make it a Rectangle

> Some datasets will not fit nicely into a single rectangle, but they will usually fit into a set of rectangles, in which case you can make a set of Excel files, each with a rectangle of data. It is best to keep each rectangle in its own file; tables scattered around a worksheet are difficult to work with, and they make it hard to export the data to CSV files. 

![Illustration from the [Openscapes](https://openscapes.org) blog [Tidy Data for reproducibility, efficiency, and collaboration](https://openscapes.org/blog/2020-10-12-tidy-data/) by Julia Lowndes and Allison Horst](images/tidy-data.jpeg)

1. Each **variable** forms a **column**
2. Each **observation** forms a **row**
3. Each **cell** is a **single measurement**

<iframe width="650" height="400" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vR7q0kwXBXTxgpoLZsPjWtJiL_P9khADMpfpNdaNfChn0wMALfjEAjQ35prUoeaSGxQa3e0iWKpESul/pubhtml?gid=1394662456&amp;single=true&amp;widget=true&amp;range=A1:F13&amp;headers=false"></iframe>

This is the data format that is the most flexible and lets you do the most with the data. Why?

Because we can work with variables as columns, and filter, and transform them easily.

### Tidy can be in the eye of the beholder

```{webr}
total_fertility <- readr::read_csv("data/total_fertility_small.csv") 
total_fertility
```
Compare to the tidy format:

```{webr}
total_fertility_longer <- total_fertility |>
  tidyr::pivot_longer(-`Total fertility rate`, names_to = "year", values_to = "rate") |>
  janitor::clean_names()
total_fertility_longer
```

:::{.callout-note}
## Data Science Tools: `tidyr::pivot_longer()` and `tidyr::pivot_wider()`

- In the `tidyr` package, `pivot_wider()` and `pivot_longer()` are extremely useful ways to make a set of columns into a single column and vice versa. See the code above.

```{webr}
total_fertility_wider <- total_fertility_longer |>
  tidyr::pivot_wider(id_cols = "total_fertility_rate", names_from = "year", values_from = "rate")
total_fertility_wider
```

![From [Tidy Explain](https://github.com/gadenbuie/tidyexplain?tab=readme-ov-file#pivot-wider-and-longer)](images/tidyr-pivoting.gif)
:::


### Tidy Data Examples

For example:

::::{.panel-tabset group="language"}
## R

```{webr}
library(readxl)
library(dplyr)
library(ggplot2)
fig5better <- read_excel("data/better_excel_examples.xlsx", sheet="fig5dbetter",
                         na="NA")
ggplot(fig5better) +
   aes(x=glucose, y=insulin, color = as.character(Subject)) +
   geom_point() +
   facet_wrap(~Subject)
```

## Python

```{pyodide}
import pandas as pd
import seaborn as sns
import matplotlib.plot as plt
fig5better = pd.read_excel("data/better_excel_examples.xlsx", sheet_name="fig5dbetter")
```
::::

Sometimes you should try and separate tables, if you are repeating a lot of information.


## Create a Data Dictionary

- Define your variables
- Describe the contents and formatting
- Define missing values
- Save as a separate text file

<iframe width="650" height="250" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vR7q0kwXBXTxgpoLZsPjWtJiL_P9khADMpfpNdaNfChn0wMALfjEAjQ35prUoeaSGxQa3e0iWKpESul/pubhtml?gid=1269156273&amp;single=true&amp;widget=true&amp;headers=false"></iframe>

**Metadata** (data or information about the dataset) is extremely useful and is better saved in another file.

## Do not use font color or highlighting as data

- Color is great, but if it conveys information you want a data scientist to utilize, put that information as a separate indicator column:

<iframe height="200" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vR7q0kwXBXTxgpoLZsPjWtJiL_P9khADMpfpNdaNfChn0wMALfjEAjQ35prUoeaSGxQa3e0iWKpESul/pubhtml?gid=596112084&amp;single=true&amp;widget=true&amp;headers=false"></iframe>
<iframe height="200" width="400" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vR7q0kwXBXTxgpoLZsPjWtJiL_P9khADMpfpNdaNfChn0wMALfjEAjQ35prUoeaSGxQa3e0iWKpESul/pubhtml?gid=1240780411&amp;single=true&amp;widget=true&amp;headers=false"></iframe>

- Getting color data out of spreadsheets is extremely difficult (Visual Basic Macros)


